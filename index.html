
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å„¿ç«¥å‘å±•æŠ¥å‘ŠæŸ¥è¯¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, select, button { font-size: 16px; padding: 6px; margin: 6px 0; width: 100%; }
    .result { margin-top: 20px; }
    canvas { width: 100% !important; height: auto !important; }
  </style>
</head>
<body>
  <h2>å„¿ç«¥å‘å±•æŠ¥å‘ŠæŸ¥è¯¢</h2>
  <label>é€‰æ‹©å¹¼å„¿å›­ï¼š</label>
  <select id="kindergarten"></select>
  <label>è¾“å…¥å­©å­å§“åï¼š</label>
  <input type="text" id="childName" placeholder="ä¾‹å¦‚ï¼šå¼ å°æ˜">
  <button onclick="query()">æŸ¥è¯¢</button>

  <div class="result" id="output"></div>
  <div id="report-section">
  <canvas id="radarChart"></canvas>
  <p style="color: gray; font-size: 12px;">âš  è‹¥ä¸‹è½½å¤±è´¥ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’ Â·Â·Â· åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</p>
</div>
<button onclick="downloadPDF()" style="margin-top: 20px;">ğŸ“„ ä¸‹è½½æµ‹è¯„æŠ¥å‘Š</button>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script>
  function downloadPDF() {
    const element = document.getElementById('report-section');
    const kg = document.getElementById("kindergarten").value || "å¹¼å„¿å›­";
    const name = document.getElementById("childName").value.trim() || "å§“å";
    const filename = `${kg}_${name}_æµ‹è¯„æŠ¥å‘Š.pdf`;
    const opt = {
      margin:       0.5,
      filename:     filename,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 4 },
      jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
  }
</script>

  <script src="data.js"></script>
  <script>
    const suggestions = {
      "Zè®°å¿†åŠ›": {
        high: "è®°å¿†åŠ›ä¼˜ç§€ï¼Œå»ºè®®å¢åŠ å›¾å½¢è®°å¿†ã€å€’èƒŒæ•…äº‹ç­‰æŒ‘æˆ˜æ€§è®­ç»ƒã€‚",
        medium: "è®°å¿†åŠ›å‘å±•æ­£å¸¸ï¼Œå¯é€šè¿‡è§„å¾‹é‡å¤å’Œè¶£å‘³æ¸¸æˆå·©å›ºã€‚",
        low: "è®°å¿†åŠ›è¾ƒå¼±ï¼Œå»ºè®®é‡‡ç”¨å›¾åƒè¾…åŠ©ã€åˆ†ç±»æ³•ç­‰å¢å¼ºè®­ç»ƒã€‚"
      },
      "Zè¯­è¨€": {
        high: "è¯­è¨€èƒ½åŠ›å¼ºï¼Œé€‚åˆè®²æ•…äº‹ã€å‚ä¸è¾©è®ºå¼äº²å­æ´»åŠ¨ã€‚",
        medium: "è¯­è¨€èƒ½åŠ›ä¸€èˆ¬ï¼Œå»ºè®®æ¯å¤©å›ºå®šæ—¶é—´å¯¹è¯ä¸é˜…è¯»ã€‚",
        low: "è¯­è¨€å‘å±•éœ€åŠ å¼ºï¼Œå¯ä½¿ç”¨å›¾ç”»ä¹¦äº’åŠ¨å’Œå¤è¿°è®­ç»ƒã€‚"
      },
      "Zæ•°å­¦": {
        high: "æ•°å­¦ç†è§£åŠ›å¥½ï¼Œå»ºè®®é€‚å½“å¼•å…¥æ•°å­—é€»è¾‘ç±»æ¸¸æˆã€‚",
        medium: "æ•°å­¦èƒ½åŠ›ä¸­ç­‰ï¼Œå»ºè®®å¤šæ¥è§¦åˆ†ç±»ã€æ’åºå’Œæ•°å­—æ´»åŠ¨ã€‚",
        low: "æ•°å­¦å‘å±•åå¼±ï¼Œå»ºè®®ä»æ•°æ•°ã€å›¾å½¢é…å¯¹å…¥æ‰‹è®­ç»ƒã€‚"
      },
      "Zå»¶è¿Ÿæ»¡è¶³": {
        high: "å…·å¤‡è‰¯å¥½è‡ªæ§åŠ›ï¼Œå¯å¼•å¯¼å®Œæˆæ›´é•¿æ—¶é—´ä»»åŠ¡ã€‚",
        medium: "å»¶è¿Ÿæ»¡è¶³èƒ½åŠ›ä¸€èˆ¬ï¼Œå¯é€šè¿‡å¥–åŠ±å»¶æ—¶å°æ¸¸æˆè®­ç»ƒã€‚",
        low: "è‡ªæ§åŠ›å¾…æå‡ï¼Œå»ºè®®ä»çŸ­æ—¶ç­‰å¾…ç»ƒä¹ é€æ­¥å¢åŠ ã€‚"
      },
      "Zçµæ´»æ€§": {
        high: "è®¤çŸ¥çµæ´»æ€§ä½³ï¼Œé€‚åˆå¤šä»»åŠ¡è½¬ç§»ä¸å˜æ¢ç»ƒä¹ ã€‚",
        medium: "çµæ´»æ€§å‘å±•æ­£å¸¸ï¼Œå»ºè®®å¤šç©å˜æ¢è§„åˆ™ç±»æ¸¸æˆã€‚",
        low: "çµæ´»æ€§è¾ƒå¼±ï¼Œå¯ä»ç®€å•è§„åˆ™è½¬å˜æ¸¸æˆé€æ­¥å¼•å¯¼ã€‚"
      }
    };

    let chart;

    function query() {
      const kg = document.getElementById("kindergarten").value;
      const name = document.getElementById("childName").value.trim();
      const output = document.getElementById("output");
      output.innerHTML = ""; document.getElementById("report-section").innerHTML = `<h2>æµ‹è¯„æŠ¥å‘Š</h2><p><b>å§“åï¼š</b>${name}</p><p><b>å¹¼å„¿å›­ï¼š</b>${kg}</p>`;

      if (!data[kg] || !data[kg][name]) {
        output.textContent = "æœªæ‰¾åˆ°è¯¥å„¿ç«¥çš„æ•°æ®ã€‚";
        if (chart) chart.destroy();
        return;
      }

      const scores = data[kg][name];
      const labels = Object.keys(scores);
      const zValues = labels.map(key => scores[key]);

      // åˆ†çº§ä¸å»ºè®®
      labels.forEach(key => {
        const z = scores[key];
        let level = "medium";
        if (z >= 1) level = "high";
        else if (z <= -1) level = "low";
        const text = `<p><b>${key.replace("Z","")}</b>ï¼ˆZ=${z.toFixed(2)}ï¼‰ï¼š${suggestions[key][level]}</p>`;
        output.innerHTML += text; document.getElementById("report-section").innerHTML += text;
      });

      // é›·è¾¾å›¾ç»˜åˆ¶
      if (chart) chart.destroy();
      const ctx = document.getElementById("radarChart");
      chart = new Chart(ctx, { document.getElementById("report-section").innerHTML += `<canvas id=\"radarPDF\" width=400 height=400></canvas>`; const pdfCtx = document.getElementById("radarPDF").getContext("2d"); new Chart(pdfCtx, {
        type: "radar",
        data: {
          labels: labels.map(k => k.replace("Z","")),
          datasets: [{
            label: `${name} çš„èƒ½åŠ›å›¾`,
            data: zValues,
            fill: true
          }]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              suggestedMin: -2,
              suggestedMax: 2
            }
          }
        }
      });
    }

    // é¡µé¢åˆå§‹åŒ–ï¼šå¡«å……å¹¼å„¿å›­åç§°
    window.onload = function() {
      const kgSelect = document.getElementById("kindergarten");
      for (let kg in data) {
        const opt = document.createElement("option");
        opt.value = kg;
        opt.textContent = kg;
        kgSelect.appendChild(opt);
      }
    };
  </script>
</body>
</html>
